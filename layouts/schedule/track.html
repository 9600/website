<dl class="dl-horizontal well">
    <% if item[:rooms].empty? %>
    <dt>Room:</dt>
    <dd>No room assigned yet</dd>
    <% else %>
    <dt>Room<%= item[:rooms].size == 1 ? '' : 's' %>:</dt>
    <dd><%= l item[:rooms].map(&$to_room) %></dd>
    <% end %>
    <dt>Calendar:</dt>
    <dd>
        <ul class="horizontal-list">
            <%
[
{ name: 'iCal', identifier: "/schedule/ical/track/#{item[:slug]}/" },
{ name: 'xCal', identifier: "/schedule/xcal/track/#{item[:slug]}/" },
].each do |cal| %>
            <li><%= l($item_by_id.fetch(cal[:identifier]), cal[:name]) %></li>
            <% end %>
        </ul>
    </dd>
</dl>

<table class="table table-striped table-bordered table-condensed">
    <thead>
        <tr>
            <th>Event</th>
            <th>Speakers</th>
            <% if item[:rooms].size > 1 %>
            <th>Room</th>
            <% end %>
            <th>Start</th>
            <th>End</th>
        </tr>
    </thead>
    <tbody>
        <%
        item[:events_by_day].each do |day_slug, event_slugs|
        unless event_slugs.empty?

        day = day(day_slug)
        rooms = (item[:rooms].size > 1) ? item[:rooms].map(&$to_room) : []
        %>
        <tr>
            <td colspan="5"><h2><%= day[:title] %></h2></td>
        </tr>
        <% event_slugs.map(&$to_event).sort_by{|e| [e[:start_time], e[:room_rank]]}.each do |e| %>
        <tr>
            <td><%= l e %></td>
            <td><%= l e[:speakers].map(&$to_speaker) %>
            <% unless rooms.empty?  %>
            <td><%= l room(e[:room]) %></td>
            <% end %>
            <td><%= ltt e[:day], e[:start_time] %></td>
            <td><%= ltt e[:day], e[:end_time] %></td>
        </tr>
        <% end %>
        <% end %>
        <% end %>
    </tbody>
</table>

