<p class="side-box">
<i class="icon-user"></i> <strong>Capacity</strong>: <%= item[:size] %>
</p>
<br style="clear: both;"/>
<%
  unless item[:events_by_day].empty? or item[:events_by_day].values.map{|l| l.size}.inject(0, :+) == 0
%>
<table class="table table-condensed">
  <thead>
    <tr>
      <th>Day</th>
      <th>Start</th>
      <th>End</th>
      <th>Track(s)</th>
    </tr>
  </thead>
  <tbody>
<%
    item[:events_by_day].each do |day_slug, event_slugs|
      unless event_slugs.empty?
        day = day(day_slug)
        events = event_slugs.map(&$to_event)
        s = events.sort_by{|e| e[:start_datetime]}.first[:start_time]
        e = events.sort_by{|e| e[:end_datetime]}.last[:end_time]
        tracks = events.map{|e| e[:track]}.uniq.map(&$to_track).sort_by{|t| t[:rank]}
      %>
      <tr>
        <td><i class="icon-calendar"></i> <%= l(day) %></td>
        <td><%= s %></td>
        <td><%= e %></td>
        <td><% unless tracks.empty? %><%= l(tracks, :name) %><% end %></td>
      </tr>
      <%
      end
    end
%>
  </tbody>
</table>
<% end %>

<% unless item[:events].empty? %>
<h3>Sessions</h3>
<table class="table table-striped table-bordered table-condensed">
    <thead>
        <tr>
            <th>Title</th>
            <th>Track</th>
            <th>Start</th>
            <th>End</th>
        </tr>
    </thead>
    <tbody>
        <% item[:events].map(&$to_event).group_by{|e| e[:day_name]}.each do |day, dayevents| %>
        <tr>
            <td colspan="4"><h3><%= day %></h3></td>
        </tr>
        <% dayevents.sort_by{|e| e[:start_datetime]}.each do |e| %>
        <tr>
            <td><%= l e %></td>
            <td><%= l track(e[:track]), :name, nil, nil, :quiet %></a></td>
            <td><%= ltt e[:day], e[:start_time], :quiet %></td>
            <td><%= ltt e[:day], e[:end_time], :quiet %></td>
        </tr>
        <% end %>
        <% end %>
    </tbody>
</table>
<% end %>
